---
driver:
  name: ec2
  # aws_ssh_key_id: <%= ENV['SAF_AWS_SSH_KEY_ID'] %>
  # user_data: ./user_data.sh
  tags:
    POC: 'SAF Github Actions'
  # security_group_ids: <%= ENV['SAF_AWS_SG_ID'] %>
  #region: <%= ENV['SAF_AWS_REGION'] %>
  # subnet_id: <%= ENV['SAF_AWS_SUBNET_ID'] %>
  instance_type: t2.large
  associate_public_ip: true

verifier:
  input_files:
    - ec2.inputs.yml
  reporter:
    - json:spec/results/ec2_%{platform}_%{suite}.json

pre_converge:
  - remote: |
      echo "NOTICE - Updating the ec2-user to keep sudo working"
      sudo chage -d $(( $( date +%s ) / 86400 )) ec2-user
      echo "NOTICE - updating ec2-user sudo config"
      sudo chmod 600 /etc/sudoers && sudo sed -i'' "/ec2-user/d" /etc/sudoers && sudo chmod 400 /etc/sudoers

transport:
  name: ssh
  # username: <%= ENV['SAF_AWS_EC2_USER'] %>
  # ssh_key: <%= ENV['SAF_AWS_EC2_SSH_KEY'] %>
  connection_timeout: 10
  connection_retries: 5
